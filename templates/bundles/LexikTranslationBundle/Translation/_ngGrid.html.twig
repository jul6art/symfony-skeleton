{% trans_default_domain 'LexikTranslationBundle' %}

{% set labels = {
    hideCol: 'translations.show_hide_columns'|trans,
    toggleAllCol: 'translations.toggle_all_columns'|trans,
    invalidateCache: 'translations.invalidate_cache'|trans,
    allTranslations: 'translations.all_translations'|trans,
    profiler: 'translations.profiler'|trans,
    dataSource: 'translations.data_source'|trans,
    latestProfiles: 'translations.latest_profiles'|trans,
    profile: 'translations.profile'|trans,
    saveRow: 'translations.save_row'|trans,
    domain: 'translations.domain'|trans,
    key: 'translations.key'|trans,
    save: 'translations.save'|trans,
    updateSuccess: 'translations.successfully_updated'|trans,
    updateFail: 'translations.update_failed'|trans,
    deleteSuccess: 'translations.successfully_deleted'|trans,
    deleteFail: 'translations.delete_failed'|trans,
    noTranslations: 'translations.no_translations'|trans,
} %}

{% set columns = [
    {
        title: "ID",
        index: "_id",
        edit: false,
        delete: false,
        filter: false,
        sortable: true,
        visible: true
    },
    {
        title: labels.domain,
        index: "_domain",
        edit: false,
        delete: false,
        filter: { _domain: "text" },
        sortable: true,
        visible: true
    },
    {
        title: labels.key,
        index: "_key",
        edit: false,
        delete: true,
        filter: { _key: "text" },
        sortable: true,
        visible: true
    }
] %}

{% for locale in locales %}
    {% set columns = columns|merge([{
        title: locale|upper,
        index: locale,
        edit: true,
        delete: true,
        filter: { locale: "text" },
        sortable: false,
        visible: true
    }]) %}
{% endfor %}

<div id="translation-grid" ng-app="translationApp" ng-controller="TranslationController">
    <div class="row margin-row grid-action-bar">
        <div class="col-md-12 btn-group">
{#            <a ng-click="hideColumnsSelector = !hideColumnsSelector" class="btn btn-sm bg-{{ theme_name() }} white waves-effect btn-manage-col">#}
{#                <i class="material-icons">visibility_off</i>#}
{#                <span class="hidden-xs">{{ labels.hideCol }}</span>#}
{#            </a>#}
            <a ng-show="!autoCacheClean" ng-click="invalidateCache()" role="button" class="btn btn-sm bg-blue-grey white waves-effect btn-invalidate-cache">
                <i class="material-icons">sync</i>
                <span class="hidden-xs">{{ labels.invalidateCache }}</span>
            </a>
        </div>
    </div>

{#    <div ng-show="hideColumnsSelector" class="row">#}
{#        <div class="col-md-12">#}
{#            <ul class="list-unstyled list-inline locales-list">#}
{#                <li class="locale">#}
{#                    <label for="toggle-all-columns" class="locale">#}
{#                        <input type="checkbox" id="toggle-all-columns" ng-model="areAllColumnsSelected" ng-checked="areAllColumnsSelected" ng-click="toggleAllColumns()"/>#}
{#                        {{ labels.toggleAllCol }}#}
{#                    </label>#}
{#                </li>#}
{#            </ul>#}
{#            <ul class="list-unstyled list-inline locales-list">#}
{#                {% for column in columns %}#}
{#                    <li ng-repeat="column in columns track by $index" class="locale">#}
{#                        <label for="toggle-{{ column.index }}">#}
{#                            <input type="checkbox" id="toggle-{{ column.index }}" ng-model="column.visible" ng-click="toggleSimilar(column)" />#}
{#                            {{ column.title }}#}
{#                        </label>#}
{#                    </li>#}
{#                {% endfor %}#}
{#            </ul>#}
{#        </div>#}
{#    </div>#}

    <div class="row margin-row">
        <div class="col-md-12">
            <div class="table-responsive">
                <table id="translationTable" class="table table-bordered table-striped">
                    <thead>
                        <tr>
                        {% for column in columns %}
                            <th ng-repeat="column in columns track by $index"
                                ng-show="column.visible"
                                ng-click="sortGrid(column)"
                                class="text-center sortable col-{{ column.index }}">
                                {{ column.title }}
                                &nbsp;
                                <span ng-if="column.sortable" class="glyphicon glyphicon-chevron-down"></span>
                            </th>
                        {% endfor %}
                            <th></th>
                        </tr>
                        <tr>
                            {% for column in columns %}
                                {% include 'bundles/LexikTranslationBundle/Translation/dataTable/_filter.html.twig' with {
                                    column: column
                                } only %}
                            {% endfor %}
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
            <div id="translationNoTranslationsMessage" class="alert alert-info hidden" role="alert">
                {{ labels.noTranslations }}
            </div>
        </div>
    </div>

    <script type="text/ng-template" id="pager-template">
        <div class="ng-cloak ng-table-pager">
            <ul class="pagination ng-table-pagination pull-right">
                <li ng-class="{'disabled': !page.active}" ng-repeat="page in pages track by $index" ng-switch="page.type">
                    <a ng-switch-when="prev" ng-click="params.changePage(page.number)" href="">&laquo;</a>
                    <a ng-switch-when="first" ng-click="params.changePage(page.number)" href=""><span ng-bind="page.number"></span></a>
                    <a ng-switch-when="page" ng-click="params.changePage(page.number)" href=""><span ng-bind="page.number"></span></a>
                    <a ng-switch-when="more" ng-click="params.changePage(page.number)" href="">&#8230;</a>
                    <a ng-switch-when="last" ng-click="params.changePage(page.number)" href=""><span ng-bind="page.number"></span></a>
                    <a ng-switch-when="next" ng-click="params.changePage(page.number)" href="">&raquo;</a>
                </li>
            </ul>
        </div>
    </script>

    <script type="text/ng-template" id="editable-row-template">
        <td ng-repeat="column in columns track by $index" ng-show="column.visible" ng-dblclick="enableMode('edit')">
{#            <span ng-show="!column.edit || (column.edit && mode != 'edit')">{{ translation[column.index] }}</span>#}
            <div ng-switch on="editType">
                <textarea ng-switch-when="textarea"
                       ng-if="column.edit"
                       ng-show="mode == 'edit'"
                       ng-model="translation[column.index]"
                       ng-keydown="save($event, 'textarea')"
                       name="column.index"
                       class="form-control"
                       rows="6">
                </textarea>
                <input ng-switch-default
                       ng-if="column.edit"
                       ng-show="mode == 'edit'"
                       ng-model="translation[column.index]"
                       ng-keydown="save($event, 'input')"
                       type="text"
                       name="column.index"
                       class="form-control input-sm" />
            </div>
            <div class="text-center">
                <button ng-show="mode == 'delete' && column.delete && translation[column.index]" type="button" class="btn btn-link delete" ng-click="delete(column)">
                    <i class="glyphicon glyphicon-remove text-danger"></i>
                </button>
            </div>
        </td>
        <td class="text-center">
            <div class="actions btn-group">
                <button ng-show="!mode" ng-click="enableMode('edit')" type="button" class="btn bg-{{ theme_name() }} btn-sm">
                    <i class="material-icons">edit</i>
                </button>
                <button ng-show="!mode" ng-click="enableMode('delete')" type="button" class="btn bg-red btn-sm">
                    <i class="material-icons">close</i>
                </button>
                <button ng-show="mode == 'edit'" ng-click="save($event, 'btn-save')" type="button" class="btn bg-{{ theme_name() }} btn-sm">
                    <i class="material-icons">save</i>
                </button>
                <button ng-show="mode != null" ng-click="disableMode()" type="button" class="btn bg-blue-grey btn-sm">
                    <i class="material-icons">cancel</i>
                </button>
            </div>
        </td>
    </script>
</div>
